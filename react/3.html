<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React之redux(数据管理) | MrZhao&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/assets/logo.jpg">
    <meta name="description" content="个人博客">
    
    <link rel="preload" href="/assets/css/0.styles.7f07d26c.css" as="style"><link rel="preload" href="/assets/js/app.14c1a38a.js" as="script"><link rel="preload" href="/assets/js/3.7ffb9e19.js" as="script"><link rel="preload" href="/assets/js/2.390750c2.js" as="script"><link rel="preload" href="/assets/js/1.8e0d53f0.js" as="script"><link rel="preload" href="/assets/js/91.fba64520.js" as="script"><link rel="prefetch" href="/assets/js/100.500e1a78.js"><link rel="prefetch" href="/assets/js/101.ea30cdc5.js"><link rel="prefetch" href="/assets/js/102.4155cdd8.js"><link rel="prefetch" href="/assets/js/103.a846ac40.js"><link rel="prefetch" href="/assets/js/104.32c96783.js"><link rel="prefetch" href="/assets/js/105.46e5cc3a.js"><link rel="prefetch" href="/assets/js/106.9639a85a.js"><link rel="prefetch" href="/assets/js/107.e7811318.js"><link rel="prefetch" href="/assets/js/108.af9b305b.js"><link rel="prefetch" href="/assets/js/109.e9b39698.js"><link rel="prefetch" href="/assets/js/11.a2a445ae.js"><link rel="prefetch" href="/assets/js/110.23db90ec.js"><link rel="prefetch" href="/assets/js/111.22cc1da5.js"><link rel="prefetch" href="/assets/js/112.5947a2cd.js"><link rel="prefetch" href="/assets/js/113.01682ae1.js"><link rel="prefetch" href="/assets/js/114.e12a1df2.js"><link rel="prefetch" href="/assets/js/115.b9540582.js"><link rel="prefetch" href="/assets/js/116.de33b9d6.js"><link rel="prefetch" href="/assets/js/117.caba018d.js"><link rel="prefetch" href="/assets/js/118.e9b37dbd.js"><link rel="prefetch" href="/assets/js/119.cce7ec2d.js"><link rel="prefetch" href="/assets/js/12.1732f38f.js"><link rel="prefetch" href="/assets/js/120.3d776eaf.js"><link rel="prefetch" href="/assets/js/121.8aabdbf7.js"><link rel="prefetch" href="/assets/js/122.095ace6a.js"><link rel="prefetch" href="/assets/js/123.b209b43b.js"><link rel="prefetch" href="/assets/js/124.37bb84fe.js"><link rel="prefetch" href="/assets/js/125.5d79d0c7.js"><link rel="prefetch" href="/assets/js/126.e2f1e24b.js"><link rel="prefetch" href="/assets/js/127.d86be66b.js"><link rel="prefetch" href="/assets/js/128.3ffe9bdd.js"><link rel="prefetch" href="/assets/js/129.0b17d888.js"><link rel="prefetch" href="/assets/js/13.863a2d51.js"><link rel="prefetch" href="/assets/js/130.49c279cd.js"><link rel="prefetch" href="/assets/js/14.051312e9.js"><link rel="prefetch" href="/assets/js/15.933aac0f.js"><link rel="prefetch" href="/assets/js/16.00409db4.js"><link rel="prefetch" href="/assets/js/17.315387cb.js"><link rel="prefetch" href="/assets/js/18.2708a8ad.js"><link rel="prefetch" href="/assets/js/19.04170ad8.js"><link rel="prefetch" href="/assets/js/20.d96eaf13.js"><link rel="prefetch" href="/assets/js/21.b79ed130.js"><link rel="prefetch" href="/assets/js/22.feb33a5a.js"><link rel="prefetch" href="/assets/js/23.272d0c92.js"><link rel="prefetch" href="/assets/js/24.37f91859.js"><link rel="prefetch" href="/assets/js/25.038b77dc.js"><link rel="prefetch" href="/assets/js/26.794ccbc3.js"><link rel="prefetch" href="/assets/js/27.4ddc1882.js"><link rel="prefetch" href="/assets/js/28.cae2bd1b.js"><link rel="prefetch" href="/assets/js/29.e1a0d2ab.js"><link rel="prefetch" href="/assets/js/30.50567e5d.js"><link rel="prefetch" href="/assets/js/31.66173695.js"><link rel="prefetch" href="/assets/js/32.2c85172d.js"><link rel="prefetch" href="/assets/js/33.7b352bb2.js"><link rel="prefetch" href="/assets/js/34.5e3082aa.js"><link rel="prefetch" href="/assets/js/35.571bda33.js"><link rel="prefetch" href="/assets/js/36.72135cf5.js"><link rel="prefetch" href="/assets/js/37.aeee99e7.js"><link rel="prefetch" href="/assets/js/38.8427dc77.js"><link rel="prefetch" href="/assets/js/39.28260fc2.js"><link rel="prefetch" href="/assets/js/4.b0c01abe.js"><link rel="prefetch" href="/assets/js/40.022cf0eb.js"><link rel="prefetch" href="/assets/js/41.7963b49d.js"><link rel="prefetch" href="/assets/js/42.9927111d.js"><link rel="prefetch" href="/assets/js/43.1bf84470.js"><link rel="prefetch" href="/assets/js/44.5b3a44dd.js"><link rel="prefetch" href="/assets/js/45.795021f5.js"><link rel="prefetch" href="/assets/js/46.8ba0e437.js"><link rel="prefetch" href="/assets/js/47.cd52b524.js"><link rel="prefetch" href="/assets/js/48.38e49769.js"><link rel="prefetch" href="/assets/js/49.523ae6f3.js"><link rel="prefetch" href="/assets/js/5.9651ef5a.js"><link rel="prefetch" href="/assets/js/50.39eda5f2.js"><link rel="prefetch" href="/assets/js/51.0ca53453.js"><link rel="prefetch" href="/assets/js/52.1bb3eadc.js"><link rel="prefetch" href="/assets/js/53.ee13be84.js"><link rel="prefetch" href="/assets/js/54.64fceaf8.js"><link rel="prefetch" href="/assets/js/55.5c82627a.js"><link rel="prefetch" href="/assets/js/56.e8bcbe0a.js"><link rel="prefetch" href="/assets/js/57.a21ef542.js"><link rel="prefetch" href="/assets/js/58.961665e1.js"><link rel="prefetch" href="/assets/js/59.2880f07d.js"><link rel="prefetch" href="/assets/js/6.c4fb4ab4.js"><link rel="prefetch" href="/assets/js/60.fd36565f.js"><link rel="prefetch" href="/assets/js/61.5b3be0d1.js"><link rel="prefetch" href="/assets/js/62.503c639e.js"><link rel="prefetch" href="/assets/js/63.b31f1346.js"><link rel="prefetch" href="/assets/js/64.04c615ba.js"><link rel="prefetch" href="/assets/js/65.7e62a7ae.js"><link rel="prefetch" href="/assets/js/66.fe9b3083.js"><link rel="prefetch" href="/assets/js/67.8de377f5.js"><link rel="prefetch" href="/assets/js/68.aca5d1ce.js"><link rel="prefetch" href="/assets/js/69.d9274036.js"><link rel="prefetch" href="/assets/js/7.1dc57eff.js"><link rel="prefetch" href="/assets/js/70.bc397c6f.js"><link rel="prefetch" href="/assets/js/71.e66f6c54.js"><link rel="prefetch" href="/assets/js/72.825005ac.js"><link rel="prefetch" href="/assets/js/73.d43e991d.js"><link rel="prefetch" href="/assets/js/74.4c40ddc3.js"><link rel="prefetch" href="/assets/js/75.05c3b26d.js"><link rel="prefetch" href="/assets/js/76.5603e715.js"><link rel="prefetch" href="/assets/js/77.72295ee7.js"><link rel="prefetch" href="/assets/js/78.6a73d785.js"><link rel="prefetch" href="/assets/js/79.b1159fda.js"><link rel="prefetch" href="/assets/js/8.c05559cd.js"><link rel="prefetch" href="/assets/js/80.2e3846b8.js"><link rel="prefetch" href="/assets/js/81.a744ff88.js"><link rel="prefetch" href="/assets/js/82.314a2fb7.js"><link rel="prefetch" href="/assets/js/83.5602bac5.js"><link rel="prefetch" href="/assets/js/84.da3d8103.js"><link rel="prefetch" href="/assets/js/85.09c85233.js"><link rel="prefetch" href="/assets/js/86.0ed74ef6.js"><link rel="prefetch" href="/assets/js/87.a82dd730.js"><link rel="prefetch" href="/assets/js/88.d605b055.js"><link rel="prefetch" href="/assets/js/89.898d184a.js"><link rel="prefetch" href="/assets/js/90.88353e3a.js"><link rel="prefetch" href="/assets/js/92.cb605472.js"><link rel="prefetch" href="/assets/js/93.ff652435.js"><link rel="prefetch" href="/assets/js/94.7762808a.js"><link rel="prefetch" href="/assets/js/95.20e710a6.js"><link rel="prefetch" href="/assets/js/96.cb8c9212.js"><link rel="prefetch" href="/assets/js/97.587efbfe.js"><link rel="prefetch" href="/assets/js/98.7cbe3954.js"><link rel="prefetch" href="/assets/js/99.d8489283.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.a32f4da1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7f07d26c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">MrZhao's blog</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/feBase/js/" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/ES6/base.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/feBase/css/1.html" class="nav-link">
  Css
</a></li><li class="dropdown-item"><!----> <a href="/feBase/browser/1.html" class="nav-link">
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/feBase/mini/1.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/react/1.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/ssr/" class="nav-link">
  SSR
</a></li><li class="dropdown-item"><!----> <a href="/cloudflare/tunnel.html" class="nav-link">
  Cloudflare
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="打包工具" class="dropdown-title"><span class="title">打包工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="打包工具" class="mobile-dropdown-title"><span class="title">打包工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/base.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/rollup/base.html" class="nav-link">
  Rollup
</a></li></ul></div></div><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/leetcode/array.html" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/test/" class="nav-link">
  常见问题
</a></div><div class="nav-item"><a href="/web3/" class="nav-link">
  web3
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/feBase/js/" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/ES6/base.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/feBase/css/1.html" class="nav-link">
  Css
</a></li><li class="dropdown-item"><!----> <a href="/feBase/browser/1.html" class="nav-link">
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/feBase/mini/1.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/react/1.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/ssr/" class="nav-link">
  SSR
</a></li><li class="dropdown-item"><!----> <a href="/cloudflare/tunnel.html" class="nav-link">
  Cloudflare
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="打包工具" class="dropdown-title"><span class="title">打包工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="打包工具" class="mobile-dropdown-title"><span class="title">打包工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/base.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/rollup/base.html" class="nav-link">
  Rollup
</a></li></ul></div></div><div class="nav-item"><a href="/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><a href="/leetcode/array.html" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/test/" class="nav-link">
  常见问题
</a></div><div class="nav-item"><a href="/web3/" class="nav-link">
  web3
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/1.html" class="sidebar-link">React基础</a></li><li><a href="/react/2.html" class="sidebar-link">React路由</a></li><li><a href="/react/3.html" aria-current="page" class="active sidebar-link">React之redux(数据管理)</a></li><li><a href="/react/4.html" class="sidebar-link">React之domdiff策略</a></li><li><a href="/react/5.html" class="sidebar-link">React之渲染优化</a></li><li><a href="/react/6.html" class="sidebar-link">React Hooks</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#数据传递">数据传递</a></li><li><a href="#redux思想以及常用方法">Redux思想以及常用方法</a></li><li><a href="#react-redux-中常用的方法">react-redux 中常用的方法</a></li><li><a href="#redux概念解析">Redux概念解析</a><ul><li><a href="#store">store</a></li><li><a href="#state">state</a></li><li><a href="#action">action</a></li><li><a href="#action-creator">action Creator</a></li><li><a href="#dispatch-action">dispatch(action)</a></li><li><a href="#reducer-state-action">reducer(state,action)</a></li><li><a href="#getstate">getState</a></li><li><a href="#subscribe">subscribe</a></li><li><a href="#模拟-redux-中的-createstore-方法">模拟 redux 中的 createStore 方法</a></li></ul></li><li><a href="#combinereducers">combineReducers</a></li><li><a href="#获取到store中的状态后如何让视图刷新">获取到store中的状态后如何让视图刷新</a><ul><li><a href="#connect-的实现原理">connect 的实现原理</a></li></ul></li><li><a href="#智能组件与木偶组件">智能组件与木偶组件</a></li><li><a href="#高阶组件">高阶组件</a></li><li><a href="#修饰器">修饰器</a></li><li><a href="#context-上下文-可实现跨组件交互">context ：上下文（可实现跨组件交互）</a></li><li><a href="#provider-组件">Provider 组件</a></li><li><a href="#中间件的应用">中间件的应用</a></li><li><a href="#常用的中间件">常用的中间件</a><ul><li><a href="#redux-logger">redux-logger</a></li><li><a href="#redux-thunk">redux-thunk</a></li><li><a href="#redux-promise">redux-promise</a></li></ul></li></ul></div><p></p> <h1 id="react之redux-数据管理"><a href="#react之redux-数据管理" class="header-anchor">#</a> React之redux(数据管理)</h1> <blockquote><p>随着<code>javascript</code>单页应用开发日趋复杂，管理不断变化的<code>state</code>十分困难。<code>Redux</code>的出现就是为了解决<code>state</code>的数据管理问题；</p></blockquote> <h2 id="数据传递"><a href="#数据传递" class="header-anchor">#</a> 数据传递</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在<code>React</code>中，数据在组件中是单向流动的。在日常开发中经常会遇到非父子组件之间数据传递的场景，可通过以下方法解决：</p> <ul><li>1、找到共同的父级组件，给父级组件设置状态，然后通过属性向后代组件传递，进行数据交互</li> <li>2、把数据通过<code>localstorage</code>存储到本地，哪个组件用到的时候再从本地获取，这时通信就变得比较麻烦；</li></ul></div> <h2 id="redux思想以及常用方法"><a href="#redux思想以及常用方法" class="header-anchor">#</a> Redux思想以及常用方法</h2> <div class="custom-block tip"><p class="custom-block-title">Redux</p> <p><code>Redux</code>是将整个应用的状态存储到一个地方，称为<code>store</code>，里边保存着一个状态树(<code>state</code>可以存储多个状态)，组件只能通过派发(<code>dispatch</code>)行为(<code>actions</code>)给<code>store</code>中的管理者(<code>reducer</code>),让管理者来修改<code>state</code>。组件内部通过订阅<code>store</code>中的状态(<code>state</code>)来刷新自己的视图；</p> <p><code>redux</code>中常用方法</p> <ul><li><code>createStore</code>：用来创建存放状态的方法，提供有关操作状态树的方法</li> <li><code>applyMiddleware</code>：<code>redux</code>中给我们提供的用来应用中间件的组件</li> <li><code>combineReducers</code>：用于将多个<code>reducer</code>合并成为一个<code>reducer</code></li> <li><code>bindActionCreators</code>：如果<code>connect</code>第一次执行传递的第二个参数是一个对象，那么就会把它包装成一个函数；</li></ul></div> <h2 id="react-redux-中常用的方法"><a href="#react-redux-中常用的方法" class="header-anchor">#</a> <code>react-redux</code> 中常用的方法</h2> <blockquote><ul><li><code>connect</code>：用于将 <code>UI</code> 组件包装成容器组件。</li> <li><code>Provider</code>：可以让容器组件拿到<code>state</code>。</li></ul></blockquote> <h2 id="redux概念解析"><a href="#redux概念解析" class="header-anchor">#</a> Redux概念解析</h2> <h3 id="store"><a href="#store" class="header-anchor">#</a> <code>store</code></h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>store</code>就是存放状态树的容器，整个页面只能有一个<code>store</code></p> <p>Redux提供了<code>createStore</code>方法来生成<code>store</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <h3 id="state"><a href="#state" class="header-anchor">#</a> <code>state</code></h3> <blockquote><p>存放在容器中的状态，可以用<code>store.getState()</code>来获取最新的状态，只能让<code>reducer</code>来修改</p></blockquote> <h3 id="action"><a href="#action" class="header-anchor">#</a> <code>action</code></h3> <blockquote><p>是一个对象，表示要把状态修改为什么，必须要有一个<code>type</code>属性，对应<code>action</code>的类型，其他属性可以自由设置</p></blockquote> <h3 id="action-creator"><a href="#action-creator" class="header-anchor">#</a> <code>action Creator</code></h3> <blockquote><p>由于有时需要多次修改<code>state</code>的同一个类型，如果都手写，会很麻烦。我们可以写成一个函数的形式来生成<code>action</code>，这个函数就叫做<code>action Creator</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//下面这种写法很麻烦</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>Types<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">,</span><span class="token literal-property property">count</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>Types<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">,</span><span class="token literal-property property">count</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//使用下面这种写法很方便</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>Types<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">,</span><span class="token literal-property property">count</span><span class="token operator">:</span>count<span class="token punctuation">}</span><span class="token comment">//名字和值相同可以只写一个</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>Types<span class="token punctuation">.</span><span class="token constant">DECREMENT</span><span class="token punctuation">,</span>count<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="dispatch-action"><a href="#dispatch-action" class="header-anchor">#</a> <code>dispatch(action)</code></h3> <blockquote><p>用来派发修改状态的任务，参数为要修改的行为(<code>action</code>),是一个对象，存放要修改的类型，和要修改的内容</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>Types<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="reducer-state-action"><a href="#reducer-state-action" class="header-anchor">#</a> <code>reducer(state,action)</code></h3> <div class="custom-block tip"><p class="custom-block-title">reducer</p> <p>创建容器的时候传入的管理状态的管理员，一个容器只能有一个管理员</p> <p>管理员的作用有两个</p> <ul><li>1、在刚创建容器的时候传入管理员，可以将容器中的状态(容器中的状态默认是<code>undefined</code>)初始化为<code>reducer</code>传入的默认状态</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">number</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token literal-property property">Add</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">number</span><span class="token operator">:</span>state<span class="token punctuation">.</span>number<span class="token operator">+</span>action<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token literal-property property">Minus</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">number</span><span class="token operator">:</span>state<span class="token punctuation">.</span>number<span class="token operator">-</span>action<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> state<span class="token punctuation">;</span><span class="token comment">//切记：返回默认状态</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> store<span class="token operator">=</span><span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//此时store中的state的值就变为了{number:0}</span>
</code></pre></div><ul><li>2、修改状态(非常重要，只有<code>reducer</code>可以修改容器中的状态)
拿到容器中当前的<code>state</code>，根据<code>dispatch</code>派发的<code>action</code>，做对应的处理，返回一个新的状态赋值给容器中的<code>state</code>；</li></ul></div> <h3 id="getstate"><a href="#getstate" class="header-anchor">#</a> <code>getState</code></h3> <blockquote><p><code>store.getState()</code>:获取容器中当前的状态；</p></blockquote> <h3 id="subscribe"><a href="#subscribe" class="header-anchor">#</a> <code>subscribe</code></h3> <blockquote><p><code>store.subscribe(fn)</code>:订阅状态，当状态改变的时候要执行哪些方法。参数为状态改变的时候需要执行的方法；</p></blockquote> <h3 id="模拟-redux-中的-createstore-方法"><a href="#模拟-redux-中的-createstore-方法" class="header-anchor">#</a> 模拟 <code>redux</code> 中的 <code>createStore</code> 方法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token parameter">reducer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> state<span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token function-variable function">getState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不修改原来的对象，返回一个新的对象</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> listeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//存放订阅了状态的方法</span>
  <span class="token comment">//派发任务的方法(参数为要修改状态的行为)</span>
  <span class="token keyword">let</span> <span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//reducer:根据仓库中老的状态,和dispatch派发的action，返回一个新的状态覆盖掉仓库中的state</span>
    state <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//状态改变之后重新执行订阅的事件</span>
    listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token function">item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//状态发生了改变之后让订阅了状态的方法执行</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">//创建此容器的时候需要根据reducer传入的状态初始化一下仓库中的状态：因为只是为了拿到reducer的默认状态，不需要修改，所以action为空；</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//订阅状态：当状态改变的时候要执行哪些事情</span>
  <span class="token keyword">let</span> <span class="token function-variable function">subscribe</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">//把订阅了状态的方法放入listeners中</span>
    listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      listeners<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item <span class="token operator">!==</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>getState<span class="token punctuation">,</span> subscribe<span class="token punctuation">,</span> dispatch<span class="token punctuation">}</span><span class="token comment">//返回三个方法</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="combinereducers"><a href="#combinereducers" class="header-anchor">#</a> <code>combineReducers</code></h2> <blockquote><p>将多个<code>reducer</code>合并为一个
<br><br>
由于一个容器中只能有一个<code>reducer</code>，所以当状态树（<code>state</code>）中有多个属性需要管理的时候就需要把多个<code>reducer</code>合并成一个<code>reducer</code>，当合并后的<code>reducer</code>执行的时候，还是分别到每一个<code>reducer</code>中进行处理，合并的<code>reducer</code>只是将多个<code>reducer</code>处理之后的结果统一起来放在一个对象当中,然后返回</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">combineReducers</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reducers</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">//把多个管理者以对象的方式传入到方法中 如{counter:counter,todo:todo}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">//返回一个reducer</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//最终的状态</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> reducers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> reducers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>state<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="获取到store中的状态后如何让视图刷新"><a href="#获取到store中的状态后如何让视图刷新" class="header-anchor">#</a> 获取到store中的状态后如何让视图刷新</h2> <div class="custom-block tip"><p class="custom-block-title">刷新视图的方法</p> <p>有两种方法：</p> <ul><li>1、由于影响视图刷新的只有<code>state</code>和<code>props</code>，所以我们拿到<code>store</code>中的状态后还要绑定给组件中的<code>this.state</code>,然后订阅一下，当<code>store</code>中的状态更新了，订阅的方法会执行，在订阅的方法中我们调用<code>this.setState</code>来重新设置一下组件的状态，这样视图就更新了；（如果这样写，每个需要状态的组件都要写一遍，很麻烦）</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">n</span><span class="token operator">:</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>counter<span class="token punctuation">.</span>num<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>un<span class="token operator">=</span>store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">n</span><span class="token operator">:</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>counter<span class="token punctuation">.</span>num<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>num<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>2、使用<code>react-redux</code>中提供的<code>connect</code>函数</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token comment">//* 代表所有，把../store/action/counter里所有的导出结果作为一个actions对象</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actions <span class="token keyword">from</span> <span class="token string">'../store/action/counter'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token comment">//导出的是connect链接后的组件</span>
<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
          <span class="token comment">// store.dispatch(actions.add(10))</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>num<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
          <span class="token comment">// store.dispatch(actions.minus(10))</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//mapDispatchToProps可以传入一个actionCreateor对象{会直接把actions对象的属性一个个的挂载到实例的this.props上}</span>
<span class="token comment">//connect:会把前面传入的两个函数执行的返回结果中的属性放在后面传入的组件的实例上可以用this.props获取</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>actions<span class="token punctuation">)</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//第二次执行的参数是当前组件</span>
</code></pre></div></div> <h3 id="connect-的实现原理"><a href="#connect-的实现原理" class="header-anchor">#</a> <code>connect</code> 的实现原理</h3> <div class="custom-block tip"><p class="custom-block-title">connect</p> <p><code>connect</code>需要执行两次</p> <p><code>connect</code>第一次执行的时候需要传递两个函数（第二个参数也可以传递一个对象）</p> <p><code>connect</code>第二次执行需要传入一个组件，第二次执行时会把第一次<code>connect</code>执行传入的两个函数执行</p> <ul><li>第一个函数执行时会默认传入容器中的状态,第二个函数执行时会默认传入<code>dispatch</code>方法；</li></ul> <p>然后把两个函数执行的返回结果（一般都是对象）中的属性挂载到传入组件实例的<code>props</code>属性上</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">mapStateToProps</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">//函数的参数是state</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">n1</span><span class="token operator">:</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>num<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">mapDispatchToProps</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token comment">//函数的参数是dispatch</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">add</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">minus</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span>mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span>


<span class="token comment">//利用了Provider的所有后代组件都可以拿到父组件属性的方式</span>
<span class="token keyword">let</span> <span class="token function-variable function">connect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">//如果第二个参数传递一个actions(一个对象)；做如下处理（与bindActionCreators处理方式相同）</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string">'Object'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> actions<span class="token operator">=</span>mapDispatchToProps<span class="token punctuation">;</span>
    <span class="token function-variable function">mapDispatchToProps</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> obj<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> actions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">Prox</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//constructor:第二个参数为父组件定义的上下文</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//获取到从父组件返回的上下文</span>
    <span class="token keyword">static</span> contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">store</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>object
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//每次状态更新重新执行下面的方法获取到最新的状态</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token function">mapStateToProps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//渲染传入的组件并把容器中的状态和dispatch挂载到组件实例的props属性上</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">}</span>
                        <span class="token punctuation">{</span><span class="token operator">...</span><span class="token function">mapDispatchToProps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span>dispatch<span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>当<code>connect</code>第一次执行时，第二个参数也可以传递一个对象；</p> <p>如果传递了一个对象，则在<code>connect</code>方法内部会调用<code>bindActionCreators</code>方法对<code>actions</code>进行处理，然后把处理后的结果再当成第二个函数执行。而且会自动的帮我们调用<code>dispacth</code>方法，所以我们在写<code>actions</code>的时候就不需要再自己手动调用<code>dispatch</code>方法了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">bindActionCreators</span><span class="token punctuation">(</span>actions<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span>

<span class="token comment">// 这个方法是redux中的</span>
<span class="token keyword">let</span> <span class="token function-variable function">bindActionCreators</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">actions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">//为什么可以直接传入一个actions,在内部会用这个函数进行包装</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> actions<span class="token punctuation">)</span><span class="token punctuation">{</span>
      obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div> <h2 id="智能组件与木偶组件"><a href="#智能组件与木偶组件" class="header-anchor">#</a> 智能组件与木偶组件</h2> <blockquote><p>智能组件：可以从<code>redux</code>中获取数据，而且可以向<code>redux</code>派发任务修改<code>state</code> <br><br>
木偶组件：不能直接从<code>redux</code>中获取数据，只能拿到从智能组件中传递过来的数据进行渲染，数据来源于<code>props</code>；也叫作<code>UI</code>组件；</p></blockquote> <h2 id="高阶组件"><a href="#高阶组件" class="header-anchor">#</a> 高阶组件</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>为什么需要高阶组件？</p> <p>当每个组件都需要处理一段公共逻辑时，如果每个组件都写一遍处理逻辑，会很麻烦，此时就需要用到高阶组件；
高阶组件也就是将组件在原有的基础上进行包装。</p> <p>如获取本地存储的高阶组件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">local</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">Component</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">LocalHight</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">}</span><span class="token comment">//此处写[key]是获取的key所代表变量的值</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> val<span class="token operator">=</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">:</span>val<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//渲染传入的组件，把LocalHight组件上的状态以props的形式传递给要渲染的Component组件</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> local
</code></pre></div></div> <h2 id="修饰器"><a href="#修饰器" class="header-anchor">#</a> 修饰器</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>一个函数就是一个修饰器，也可以称为修饰函数，可以修饰用声明类方式生成的组件，不能修饰用函数方式生成的组件（用函数生成的组件存在变量提升）</p> <p>需要安装<code>transform-decorators-legacy</code> 包之后才可使用</p> <p>用法：
将修饰函数写在需要修饰的类的上方，修饰函数前面需要加**<code>@</code>**,修饰函数执行的时候会把修饰的类当成参数传入到修饰函数中；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> actions <span class="token keyword">from</span> <span class="token string">&quot;../../store/actions/session&quot;</span><span class="token punctuation">;</span>
@<span class="token function">connect</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">.</span>session<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>actions<span class="token punctuation">)</span> <span class="token comment">//此处不需要再写第二次执行了，会默认的让connect修饰函数执行并把MHeader组件传入；修饰函数必须和要修饰的组件连在一起；</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MHeader</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span><span class="token comment">//此处导出的是修饰后的组件；</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <h2 id="context-上下文-可实现跨组件交互"><a href="#context-上下文-可实现跨组件交互" class="header-anchor">#</a> <code>context</code> ：上下文（可实现跨组件交互）</h2> <div class="custom-block tip"><p class="custom-block-title">context</p> <p>每个组件的实例都有<code>context</code>属性，默认值为<code>{}</code>；
父组件可以通过拿到后代组件的上下文，并通过上下文传递给后代组件数据;(好处在于可以跨组件传输， 即爷爷可以传递给孙子)</p> <p>要用到的两个属性和一个方法</p> <ul><li><code>static</code> 属性：</li> <li><code>childContextTypes</code>：父组件用来定义传递给后代组件数据的类型</li> <li><code>contextTypes</code> ：后代组件用来定义接受数据的类型（想要接受父组件传递的哪个数据，就定义同样的类型即可）</li> <li><code>getChildContext</code>：父组件用来获取后代组件上下文的方法，返回值为后代组件的上下文;（可在返回值当中传递后代组件需要的数据）;</li></ul> <p>设置了之后，后代组件就可以通过<code>this.context.xxx</code>来获取父组件中的数据了；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span>
<span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">&quot;./Header&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//爷爷组件</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span><span class="token string">'red'</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> childContextTypes <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">//定义传递给后代组件数据的类型</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
    <span class="token literal-property property">setColor</span><span class="token operator">:</span>PropTypes<span class="token punctuation">.</span>func
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function-variable function">setColor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      color
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">getChildContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
  <span class="token comment">//返回值为后代组件的上下文</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>color<span class="token punctuation">,</span><span class="token literal-property property">setColor</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>setColor<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Header<span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//儿子组件</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Header</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">setColor</span><span class="token operator">:</span>PropTypes<span class="token punctuation">.</span>func
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token string">'green'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>变绿<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Title<span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//孙子组件</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Title</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">//定义要从父组件获取的数据的类型</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span>PropTypes<span class="token punctuation">.</span>string
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 通过context获取父组件定义的数据</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>color<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Title<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <h2 id="provider-组件"><a href="#provider-组件" class="header-anchor">#</a> <code>Provider</code> 组件</h2> <div class="custom-block tip"><p class="custom-block-title">Provider</p> <p><code>react-redux</code> 提供<code>Provider</code>组件，可以让<code>Provider</code>中的根组件以及根组件中的所有组件都能拿到容器（<code>store</code>），从而拿到容器中的的<code>state</code>。（<code>Provider</code>中只能有一个根组件）；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDom<span class="token punctuation">,</span><span class="token punctuation">{</span>render<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'./components/Counter'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Todo <span class="token keyword">from</span> <span class="token string">&quot;./components/Todo&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Provider<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Counter<span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Todo<span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span>window<span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码中，<code>Provider</code>在根组件（<code>&lt;div&gt;</code>）外面包了一层,这样一来，<code>div</code>的所有后代组件就默认都可以拿到<code>store</code>了。 它的原理是利用<code>React</code>组件的<code>context</code>属性;</p> <p><code>Provider</code>实现原理如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">'prop-types'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Provider</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token comment">//定义传递给后代组件数据的类型</span>
  <span class="token keyword">static</span> childContextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">store</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>object
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">getChildContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//返回值为后代组件的上下文</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">store</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>store<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token comment">//渲染的时候渲染的是Provider下的子节点</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <h2 id="中间件的应用"><a href="#中间件的应用" class="header-anchor">#</a> 中间件的应用</h2> <div class="custom-block tip"><p class="custom-block-title">中间件</p> <p><code>applyMiddleware</code>组件：<code>redux</code>中给我们提供的用来应用中间件的组件：</p> <p>如何使用：</p> <ul><li>1、从<code>redux</code>中导入<code>applyMiddleware</code>组件，</li> <li>2、安装需要用的中间件模块</li> <li>3、在<code>createStore</code>的第二个参数中应用中间件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">,</span>applyMiddleware<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token comment">//applyMiddleware:redux中的方法，可以帮我们应用中间件</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> reduxLogger <span class="token keyword">from</span> <span class="token string">'redux-logger'</span><span class="token punctuation">;</span><span class="token comment">//在控制台显示每次操作的日志</span>
<span class="token keyword">import</span> reduxThunk <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span><span class="token punctuation">;</span><span class="token comment">//可以让我们派发任务的方法返回一个函数</span>
<span class="token keyword">import</span> reduxPromise <span class="token keyword">from</span> <span class="token string">'redux-promise'</span><span class="token punctuation">;</span><span class="token comment">//可以在actionCreator中返回一个promise对象，它会等待成功后将成功的结果派发出去</span>
<span class="token comment">//第二个参数为应用中间件：在控制台中可以显示每次的操作；</span>
<span class="token keyword">let</span> obj<span class="token operator">=</span><span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>reduxLogger<span class="token punctuation">,</span>reduxThunk<span class="token punctuation">,</span>reduxPromise<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>_store<span class="token operator">=</span>obj<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> obj <span class="token punctuation">;</span>
</code></pre></div></div> <h2 id="常用的中间件"><a href="#常用的中间件" class="header-anchor">#</a> 常用的中间件</h2> <h3 id="redux-logger"><a href="#redux-logger" class="header-anchor">#</a> <code>redux-logger</code></h3> <blockquote><p>可在控制台显示每次操作状态的日志</p></blockquote> <h3 id="redux-thunk"><a href="#redux-thunk" class="header-anchor">#</a> <code>redux-thunk</code></h3> <blockquote><p>可以让我们<code>actions</code>中的方法返回一个函数（原本是返回一个对象）</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Types <span class="token keyword">from</span> <span class="token string">'../action-types'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>getSliders<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../api/home&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> actions<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token comment">//选择课程</span>
  <span class="token function">changeLesson</span><span class="token punctuation">(</span><span class="token parameter">lesson</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>Types<span class="token punctuation">.</span><span class="token constant">SELECTLESSON</span><span class="token punctuation">,</span>lesson<span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//获得轮播图的数据</span>
  <span class="token function">getSlidersAPI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// redux-thunk可以返回函数 将函数执行并且将dispatch的权限交给你来处理</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span>getState</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//redux-promise的用法：可以将payload的promise执行，将执行后返回结果赋值给payload</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>Types<span class="token punctuation">.</span><span class="token constant">SETSLIDERS</span><span class="token punctuation">,</span><span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token function">getSliders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> actions<span class="token punctuation">;</span>
</code></pre></div><h3 id="redux-promise"><a href="#redux-promise" class="header-anchor">#</a> <code>redux-promise</code></h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>可让<code>actions</code>中的方法返回一个<code>promise</code>对象，他会等待成功后将成功的结果派发出去</p> <p>如果<code>actions</code>中的方法返回的是一个<code>promise</code>对象，是不管失败的，只有成功了之后才会把数据返回</p> <p>如果<code>actions</code>中的方法返回的是一个对象，对象属性中有<code>payload</code>，而且<code>payload</code>是一个<code>promise</code>对象，它会让这个<code>promise</code>执行，会把成功或者失败的结果都进行派发；写成对象之后,<code>reducer</code>对应的方法中使用的就是<code>action.payLoad</code>属性所对应的值了；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span>  <span class="token operator">*</span> <span class="token keyword">as</span> Types <span class="token keyword">from</span> <span class="token string">'./action-types'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> actions<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token function-variable function">add</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//没使用reduxThunk之前返回的是一个对象</span>
    <span class="token comment">// return {type:Types.ADD,count};</span>
    <span class="token comment">//使用了reduxThunk之后可以返回一个函数，执行add的时候会将函数执行并且将dispatch的权限交给你(可以发送异步操作)</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> getState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>Types<span class="token punctuation">.</span><span class="token constant">ADD</span><span class="token punctuation">,</span>count<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>Types<span class="token punctuation">.</span><span class="token constant">ADD</span><span class="token punctuation">,</span>count<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>Types<span class="token punctuation">.</span><span class="token constant">ADD</span><span class="token punctuation">,</span>count<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">minus</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// return {type:Types.MINUS,count};</span>
    <span class="token comment">//使用了reduxPromise之后，可以在执行minus的时候返回一个promise对象，会等待成功后将成功的结果派发出去</span>
    <span class="token comment">//默认返回promise的写法是不管失败的</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span>Types<span class="token punctuation">.</span><span class="token constant">MINUS</span><span class="token punctuation">,</span>count<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment">//如果返回一个对象，对象属性中有payload，而且payload是一个promise对象，它会让这个promise执行，会把成功或者失败的结果都进行派发</span>
    <span class="token comment">//写成对象之后,reducer对应的方法中使用的就是action.payLoad属性所对应的值了</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span>Types<span class="token punctuation">.</span><span class="token constant">MINUS</span><span class="token punctuation">,</span>
      <span class="token literal-property property">payload</span><span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//此处默认导出的是dispatch时用到的方法：需要在connect执行的时候当作第二的参数传入，connect方法会把actions中的属性一个个的挂载到后面传入组件实例的props上</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> actions<span class="token punctuation">;</span>
</code></pre></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/19/2020, 11:40:50 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react/2.html" class="prev">
        React路由
      </a></span> <span class="next"><a href="/react/4.html">
        React之domdiff策略
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.14c1a38a.js" defer></script><script src="/assets/js/3.7ffb9e19.js" defer></script><script src="/assets/js/2.390750c2.js" defer></script><script src="/assets/js/1.8e0d53f0.js" defer></script><script src="/assets/js/91.fba64520.js" defer></script>
  </body>
</html>
