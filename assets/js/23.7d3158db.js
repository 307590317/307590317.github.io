(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{326:function(t,a,s){t.exports=s.p+"assets/img/ssl.7864b099.jpg"},343:function(t,a,s){"use strict";s.r(a);var e=s(25),l=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#tunnel原理"}},[t._v("Tunnel原理")])]),a("li",[a("a",{attrs:{href:"#开通服务"}},[t._v("开通服务")]),a("ul",[a("li",[a("a",{attrs:{href:"#添加域名"}},[t._v("添加域名")])]),a("li",[a("a",{attrs:{href:"#更改dns解析"}},[t._v("更改DNS解析")])]),a("li",[a("a",{attrs:{href:"#等待dns解析生效"}},[t._v("等待DNS解析生效")])])])]),a("li",[a("a",{attrs:{href:"#安装-cloudflared"}},[t._v("安装 cloudflared")])]),a("li",[a("a",{attrs:{href:"#配置-cloudflared"}},[t._v("配置 cloudflared")])]),a("li",[a("a",{attrs:{href:"#创建-tunnel"}},[t._v("创建 Tunnel")])]),a("li",[a("a",{attrs:{href:"#创建-route"}},[t._v("创建 Route")])]),a("li",[a("a",{attrs:{href:"#启动-tunnel"}},[t._v("启动 Tunnel")])]),a("li",[a("a",{attrs:{href:"#遇到的问题"}},[t._v("遇到的问题")]),a("ul",[a("li",[a("a",{attrs:{href:"#开通完服务dns生效后-域名对应网站301"}},[t._v("开通完服务DNS生效后，域名对应网站301")])])])])])]),a("p"),t._v(" "),a("h1",{attrs:{id:"cloudflare-tunnel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cloudflare-tunnel"}},[t._v("#")]),t._v(" Cloudflare Tunnel")]),t._v(" "),a("p",[t._v("前端开发中经常会遇到在手机 App 打开 WebView 来访问网页的情况，一些 App 的生产版本对访问的地址有比较严格的限制，比如不支持本地局域网、仅支持 HTTPS 访问等。对以上情况，我们可以使用 "),a("code",[t._v("Cloudflare Tunnel")]),t._v(" 来突破这个限制。")]),t._v(" "),a("h2",{attrs:{id:"tunnel原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tunnel原理"}},[t._v("#")]),t._v(" Tunnel原理")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[a("code",[t._v("Tunnel")]),t._v(" 的原理是在本地启动一个 "),a("code",[t._v("cloudflared")]),t._v(" 进程，创建一个从 "),a("code",[t._v("cloudflare edge")]),t._v(" 到本地 "),a("code",[t._v("server")]),t._v(" 的通道。这样访问者就可以通过 "),a("code",[t._v("edge")]),t._v(" 来访问本地服务了。")])]),t._v(" "),a("h2",{attrs:{id:"开通服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开通服务"}},[t._v("#")]),t._v(" 开通服务")]),t._v(" "),a("h3",{attrs:{id:"添加域名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加域名"}},[t._v("#")]),t._v(" 添加域名")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("首先，需要确保你在 "),a("code",[t._v("Cloudflare")]),t._v(" 下有可管理的域名,并且已经解析DNS记录。然后在"),a("code",[t._v("Cloudflare")]),t._v("主页 有个输入现有域名，输入你的域名就行，我这里用的是阿里的域名，按照页面提示开通")])]),t._v(" "),a("h3",{attrs:{id:"更改dns解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更改dns解析"}},[t._v("#")]),t._v(" 更改DNS解析")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("将原来域名的解析更改为"),a("code",[t._v("Cloudflare")]),t._v("提供的"),a("code",[t._v("DNS")]),t._v(",我这里用的是阿里的域名，就需要去阿里的控制台修改域名对应的"),a("code",[t._v("DNS")]),t._v("，修改好之后，阿里这边一般要1-5分钟生效。"),a("code",[t._v("Cloudflare")]),t._v("会再慢一点，大概7-8分钟左右。")])]),t._v(" "),a("h3",{attrs:{id:"等待dns解析生效"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#等待dns解析生效"}},[t._v("#")]),t._v(" 等待DNS解析生效")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("修改好"),a("code",[t._v("DNS")]),t._v("之后，阿里这边一般要1-5分钟生效。"),a("code",[t._v("Cloudflare")]),t._v("会再慢一点，大概7-8分钟左右。在"),a("code",[t._v("Cloudflare")]),t._v("这边看到你添加的域名状态为"),a("code",[t._v("活动")]),t._v("时，就说明正常生效了，可以进行第4项，配置"),a("code",[t._v("cloudflared")]),t._v("了")])]),t._v(" "),a("h2",{attrs:{id:"安装-cloudflared"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-cloudflared"}},[t._v("#")]),t._v(" 安装 cloudflared")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("参考官方文档 https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/downloads/ 在你的操作系统下安装 "),a("code",[t._v("cloudflared")]),t._v("。MacOS 下直接使用 brew 进行安装。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("brew "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" cloudflared\n")])])])]),t._v(" "),a("h2",{attrs:{id:"配置-cloudflared"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-cloudflared"}},[t._v("#")]),t._v(" 配置 cloudflared")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("安装完成之后，在本地命令行内进行登录操作。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("cloudflared login\n")])])]),a("p",[t._v("自动弹出浏览器页面，选择你的域名并授权，按照提示进行下一步操作（关闭浏览器，回到终端）。")])]),t._v(" "),a("h2",{attrs:{id:"创建-tunnel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-tunnel"}},[t._v("#")]),t._v(" 创建 Tunnel")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[a("code",[t._v("Tunnel")]),t._v(" 可以取任意名称，这里创建一个叫做 "),a("code",[t._v("mobiletest")]),t._v(" 的 "),a("code",[t._v("Tunnel")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("cloudflared tunnel create mobiletest\n")])])])]),t._v(" "),a("h2",{attrs:{id:"创建-route"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-route"}},[t._v("#")]),t._v(" 创建 Route")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("使用下面的命令创建一个 "),a("code",[t._v("dns route")]),t._v("，这个命令创建一个 "),a("code",[t._v("DNS CNAME")]),t._v("，指向 "),a("code",[t._v("mobiletest Tunnel")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("cloudflared tunnel route dns mobiletest mobiletest.your.domain\n")])])])]),t._v(" "),a("h2",{attrs:{id:"启动-tunnel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动-tunnel"}},[t._v("#")]),t._v(" 启动 Tunnel")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("先在本地启动想要外网可以访问的服务，然后使用 "),a("code",[t._v("tunnel run")]),t._v(" 启动 "),a("code",[t._v("mobiletest Tunnel")]),t._v("，使用 --url 参数将 "),a("code",[t._v("Tunnel")]),t._v(" 连接到本地服务。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("cloudflared tunnel run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--url")]),t._v(" http://localhost:3000 mobiletest\n")])])]),a("p",[t._v("接下来，打开浏览器，输入前面创建的 "),a("code",[t._v("CNAME")]),t._v(" 地址 "),a("code",[t._v("mobiletest.your.domain")]),t._v(" 就可以加载本地服务了。")])]),t._v(" "),a("h2",{attrs:{id:"遇到的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题"}},[t._v("#")]),t._v(" 遇到的问题")]),t._v(" "),a("h3",{attrs:{id:"开通完服务dns生效后-域名对应网站301"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开通完服务dns生效后-域名对应网站301"}},[t._v("#")]),t._v(" 开通完服务DNS生效后，域名对应网站301")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("点击到对应的域名中，左边侧边栏选择"),a("code",[t._v("SSL/TLS")]),t._v("设置,进入之后,看下当前的加密模式是不是 "),a("code",[t._v("完全(严格)")]),t._v(",如果不是，需要点击右边的配置更改为"),a("code",[t._v("完全(严格)")]),t._v("，不然就会导致一直301重定向\n")]),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:s(326),width:"800/"}})]),a("p")])])}),[],!1,null,null,null);a.default=l.exports}}]);